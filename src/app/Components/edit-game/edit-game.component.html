<div style="display: flex; flex-direction: column; gap: 1rem; padding: 1rem">
	<p-sidebar [visible]="true" class="editmode">
		<ng-template pTemplate="header">
			<div class="flex align-items-center gap-2">
				<span class="font-bold"> Editing {{ currentGame?.name }} </span>
			</div>
		</ng-template>
		<p-panelMenu [model]="items" styleClass="w-full md:w-20rem" />
		<br />
		<p-button
			label="Close"
			[routerLink]="['/game/' + currentGame?.id]"
			icon="pi pi-times"
		></p-button>
	</p-sidebar>
	<div [style]="{ width: '80vw' }">
		<div class="content">
			<div
				style="
					width: 100%;
					display: flex;
					gap: 1rem;
					justify-content: space-between;
					align-items: center;
					margin-top: 15vh;
					padding: 1rem;
				"
				*ngIf="hideSearch"
			>
				<p-floatLabel style="width: 400px">
					<input
						pInputText
						id="searchGame"
						[(ngModel)]="searchingGame"
						(keydown.enter)="searchGameInAPI()"
					/>
					<label for="searchGame">Search A Game</label>
				</p-floatLabel>
				<p-button label="Search" (click)="searchGameInAPI()"></p-button>
				<p-checkbox
					[(ngModel)]="strict"
					[binary]="true"
					label="Strict"
				></p-checkbox>
				<p-button
					label="Select"
					*ngIf="hideSelectBtn"
					(click)="selectItem()"
				></p-button>
			</div>
			<div id="providers" *ngIf="hideSearch">
				<app-igdb
					*ngIf="selectedProvider === 'igdb'"
					[message]="message"
					[searchedGames]="searchedGames"
					[(selectedItem)]="selectedItem"
				></app-igdb>

				<app-ytdl
					*ngIf="selectedProvider === 'ytdl'"
					[message]="message"
					[searchedGames]="searchedGames"
					[(selectedItem)]="selectedItem"
				></app-ytdl>

				<app-steam-grid
					*ngIf="selectedProvider === 'steam_grid'"
					[message]="message"
					[searchedGames]="searchedGames"
					[(selectedItem)]="selectedItem"
					(selectItem)="selectItem()"
				></app-steam-grid>
			</div>
			<div id="gameInfo" *ngIf="currentGame && !hideSearch">
				<div *ngIf="selectedProvider === 'general'">
					<h1>General Info</h1>
					<form
						[formGroup]="info"
						(ngSubmit)="saveGameInfo()"
						class="formDisplay"
					>
						<p-button
							label="Save"
							class="posBL"
							icon="pi pi-save"
							type="submit"
						></p-button>
						<ng-container *ngIf="currentGame">
							<div
								*ngFor="let field of currentGame | keyvalue"
								[style.display]="
									generalKeys.includes(field.key) ? 'block' : 'none'
								"
							>
								<p-floatLabel *ngIf="generalKeys.includes(field.key)">
									<input
										pInputText
										[id]="field.key"
										[formControlName]="field.key"
									/>
									<label [for]="field.key">{{ field.key }}</label>
								</p-floatLabel>
								<small id="tags-helper" *ngIf="field.key === 'tags'">
									Tags are separated by commas
								</small>
							</div>
						</ng-container>
					</form>
				</div>
				<div *ngIf="selectedProvider === 'personal'">
					<h1>Personal Stats</h1>
					<form
						[formGroup]="stat"
						(ngSubmit)="saveGameStat()"
						class="formDisplay"
					>
						<ng-container *ngIf="currentGame">
							<div
								*ngFor="let field of currentGame | keyvalue"
								[style.display]="
									statKeys.includes(field.key) && field.key !== 'status'
										? 'block'
										: 'none'
								"
							>
								<p-floatLabel *ngIf="statKeys.includes(field.key)">
									<input
										pInputText
										[id]="field.key"
										[formControlName]="field.key"
									/>
									<label [for]="field.key">{{ field.key }}</label>
								</p-floatLabel>
							</div>
							<p-dropdown
								[formControlName]="'status'"
								[options]="statuses"
								[showClear]="true"
								placeholder="Select a status"
							/>
						</ng-container>
						<p-button label="Save" type="submit"></p-button>
					</form>
				</div>
				<div *ngIf="selectedProvider === 'media'">
					<h1>Media</h1>
					<ng-container *ngIf="currentGame">
						<div class="formDisplay">
							<h2>Background</h2>
							<div>
								<img
									[src]="currentGame.background"
									width="150px"
									(click)="openFileChooser('background-input')"
								/>
								<input
									type="file"
									id="background-input"
									style="display: none"
									(change)="onFileSelected($event, 'background')"
								/>
							</div>
						</div>
						<div class="formDisplay">
							<h2>Jaquette</h2>
							<div>
								<img
									[src]="currentGame.jaquette"
									width="150px"
									(click)="openFileChooser('jaquette-input')"
								/>
								<input
									type="file"
									id="jaquette-input"
									style="display: none"
									(change)="onFileSelected($event, 'jaquette')"
								/>
							</div>
						</div>
						<div class="formDisplay">
							<h2>Logo</h2>
							<div>
								<img
									[src]="currentGame.logo"
									width="150px"
									(click)="openFileChooser('logo-input')"
								/>
								<input
									type="file"
									id="logo-input"
									style="display: none"
									(change)="onFileSelected($event, 'logo')"
								/>
							</div>
						</div>
						<div class="formDisplay">
							<h2>Icon</h2>
							<div>
								<img
									[src]="currentGame.icon"
									width="150px"
									(click)="openFileChooser('icon-input')"
								/>
								<input
									type="file"
									id="icon-input"
									style="display: none"
									(change)="onFileSelected($event, 'icon')"
								/>
							</div>
						</div>
						<div class="formDisplay">
							<h2>Screenshots</h2>
							<p-button
								icon="pi pi-plus"
								(onClick)="openFileChooser('screen-input')"
							/>
							<div
								*ngFor="let screenshot of currentGame.screenshots | keyvalue"
								style="
									display: flex;
									gap: 1rem;
									flex-direction: row;
									flex-wrap: nowrap;
									justify-content: center;
									align-items: center;
								"
							>
								<img src="{{ screenshot.value }}" width="250px" />
								<p-button
									icon="pi pi-times"
									(click)="deleteScreenshot(screenshot.value)"
									[rounded]="true"
									severity="danger"
								/>
							</div>

							<input
								type="file"
								id="screen-input"
								style="display: none"
								(change)="onFileSelected($event, 'screenshot')"
							/>
						</div>
						<div class="formDisplay">
							<h2>Background Music</h2>

							<div style="text-align: center">
								<p-button
									icon="pi pi-plus"
									(onClick)="openFileChooser('music-input')"
								/>
								<div style="margin-top: 1rem">
									<p-floatLabel>
										<input pInputText id="music-name" [(ngModel)]="YTURL" />
										<label for="music-name">Youtube Video URL</label>
									</p-floatLabel>
								</div>
								<p-button
									icon="pi pi-save"
									(click)="searchYT4BGMusic()"
									[style]="{ margin: '1rem' }"
									[rounded]="true"
								/>
								<p-button
									icon="pi pi-trash"
									(click)="deleteBackgroundMusic()"
									[style]="{ margin: '1rem' }"
									[rounded]="true"
									severity="danger"
								/>
								<br />
								<audio src="{{ currentGame.backgroundMusic }}" controls></audio>

								<input
									type="file"
									id="music-input"
									style="display: none"
									(change)="onFileSelected($event, 'audio')"
								/>
							</div>
						</div>
						<div class="formDisplay" style="text-align: center">
							<h2>Video</h2>
							<p-button
								icon="pi pi-plus"
								(onClick)="openFileChooser('vide-input')"
							/>
							<div *ngFor="let video of currentGame.videos | keyvalue">
								<video src="{{ video.value }}" controls width="380px"></video>
								<br />
								<p-button
									icon="pi pi-trash"
									(click)="deleteVideo(video.value)"
									[rounded]="true"
									severity="danger"
								/>
							</div>
							<input
								type="file"
								id="vide-input"
								style="display: none"
								(change)="onFileSelected($event, 'video')"
							/>
						</div>
					</ng-container>
				</div>
				<div *ngIf="selectedProvider === 'exec'">
					<h1>Execution</h1>
					<form
						[formGroup]="exec"
						(ngSubmit)="saveGameExec()"
						class="formDisplay"
					>
						<p-button
							id="playbtn"
							icon="pi pi-link"
							[style.background-color]="'purple'"
							label="Link"
							(click)="linkGame()"
						></p-button>
						<ng-container *ngIf="currentGame">
							<div
								*ngFor="let field of currentGame | keyvalue"
								[style.display]="
									execKeys.includes(field.key) ? 'block' : 'none'
								"
							>
								<p-floatLabel *ngIf="execKeys.includes(field.key)">
									<input
										pInputText
										[id]="field.key"
										[formControlName]="field.key"
									/>
									<label [for]="field.key">{{ field.key }}</label>
								</p-floatLabel>
							</div>
						</ng-container>
						<p-button label="Save" type="submit"></p-button>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
